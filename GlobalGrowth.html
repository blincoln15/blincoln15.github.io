<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.plot.ly/plotly-2.25.2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script> <!-- For CSV parsing -->
  <title>Heatmap from CSV</title>
  <link rel="stylesheet" href="style.css">
</head>
<ul>
  <li><a href="index.html">Home</a></li>
  <li><a href="GrowthOverTime.html">Growth Over Time</a></li>
  <li><a class="active" href="GlobalGrowth.html">Global Growth</a></li>  
  <li style="float:right"><a href="#about">About</a></li>
</ul>
<body>
    <div id="heatmap" style="width: 600px; height: 400px;"></div>
    <div id="heatmap" style="width: 600px; height: 400px;"></div>
<script>
    async function createMapboxHeatmap() {
        // Define the CSV file names for each dataset
        const csvFiles = ['csv/ww_average_output.csv'
                          //'csv/ww_yield_1981.csv', 'csv/ww_yield_1982.csv', 'csv/ww_yield_1983.csv', 'csv/ww_yield_1984.csv', 'csv/ww_yield_1985.csv',
                         //'csv/ww_yield_1986.csv', 'csv/ww_yield_1987.csv', 'csv/ww_yield_1988.csv', 'csv/ww_yield_1989.csv', 'csv/ww_yield_1990.csv',
                          //'csv/ww_yield_1991.csv', 'csv/ww_yield_1992.csv', 'csv/ww_yield_1993.csv', 'csv/ww_yield_1994.csv', 'csv/ww_yield_1995.csv',
                          //'csv/ww_yield_1996.csv', 'csv/ww_yield_1997.csv', 'csv/ww_yield_1998.csv', 'csv/ww_yield_1999.csv', 'csv/ww_yield_2000.csv',
                          //'csv/ww_yield_2001.csv', 'csv/ww_yield_2002.csv', 'csv/ww_yield_2003.csv', 'csv/ww_yield_2004.csv', 'csv/ww_yield_2005.csv',
                          //'csv/ww_yield_2006.csv', 'csv/ww_yield_2007.csv', 'csv/ww_yield_2008.csv', 'csv/ww_yield_2009.csv', 'csv/ww_yield_2010.csv',
                          //'csv/ww_yield_2007.csv', 'csv/ww_yield_2008.csv', 'csv/ww_yield_2009.csv', 'csv/ww_yield_2010.csv', 'csv/ww_yield_2011.csv',
                          //'csv/ww_yield_2012.csv', 'csv/ww_yield_2013.csv', 'csv/ww_yield_2014.csv', 'csv/ww_yield_2015.csv', 'csv/ww_yield_2016.csv'
                          ];

        // Function to load and parse CSV
        async function loadCsv(file) {
            const response = await fetch(file);
            const csvText = await response.text();
            return Papa.parse(csvText, { header: true, dynamicTyping: true }).data;
        }

        // Load all datasets
        const datasets = await Promise.all(csvFiles.map(loadCsv));

        // Process each dataset into a trace
        const frames = datasets.map((data, index) => {
            const lat = data.map(row => row.lat);
            const lon = data.map(row => row.lon);
            const z = data.map(row => row.var);

            return {
                name: `Output ${index + 1}`,
                data: [{
                    type: 'densitymapbox',
                    lon: lon,
                    lat: lat,
                    z: z,
                    colorscale: 'Spectral',
                    coloraxis: 'coloraxis',
                    radius: 10
                }]
            };
        });

        // Define the initial frame
        const initialFrame = frames[0].data[0];

        // Define the layout
        const layout = {
            mapbox: {
                style: "carto-positron",
                center: { lat: datasets[0][0].lat, lon: datasets[0][0].lon },
                zoom: 0
            },
            coloraxis: { colorscale: 'Spectral_r' },
            title: 'Heatmap with Mapbox Slider',
            margin: { t: 50, b: 0, l: 0, r: 0 },
            updatemenus: [{
                type: 'buttons',
                showactive: false,
                x: 0.1,
                y: -0.2,
                buttons: [
                    {
                        label: 'Play',
                        method: 'animate',
                        args: [null, { frame: { duration: 1000, redraw: true }, fromcurrent: true }]
                    },
                    {
                        label: 'Pause',
                        method: 'animate',
                        args: [[null], { mode: 'immediate', frame: { duration: 0, redraw: false } }]
                    }
                ]
            }],
            sliders: [{
                active: 0,
                steps: frames.map((frame, i) => ({
                    label: `Output ${i + 1}`,
                    method: 'animate',
                    args: [[frame.name], { mode: 'immediate', frame: { duration: 500, redraw: true } }]
                }))
            }]
        };

        // Plot the initial heatmap with frames and slider
        Plotly.newPlot('heatmap', [initialFrame], layout, { frames });
    }

    // Call the function to create the heatmap
    createMapboxHeatmap();
</script>
</body>
</html>
